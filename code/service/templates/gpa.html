<!DOCTYPE html>
<html>
<head>
    <title>GPA Management</title>
    <style>
        table { border-collapse: collapse; width: 80%; margin: 20px; }
        th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
        th { background-color: #f2f2f2; }
        .form-container { margin: 20px; padding: 20px; border: 1px solid #ccc; width: 300px; }
        input, select { 
            width: 200px; 
            padding: 5px; 
            margin: 5px 0; 
            display: block; 
        }
        button { margin: 5px; padding: 5px 10px; }
    </style>
</head>
<body>
    <div class="form-container">
        <h3>Add New GPA Record</h3>
        <input type="text" id="studentId" placeholder="Student ID" required>
        <input type="text" id="studentName" placeholder="Student Name" required>
        <select id="grade">
            <option value="">Select Grade</option>
            <option value="Year1">Year1</option>
            <option value="Year2">Year2</option>
            <option value="Year3">Year3</option>
            <option value="Year4">Year4</option>
        </select>
        <input type="number" id="gpa" step="0.01" min="0" max="4" placeholder="GPA (0-4)" required>
        <button onclick="validateAndAdd()">Add Record</button>
    </div>

    <h3>GPA Records</h3>
    <table id="gpaTable">
        <thead>
            <tr>
                <th>Student ID</th>
                <th>Name</th>
                <th>Grade</th>
                <th>GPA</th>
                <th>Operations</th>
            </tr>
        </thead>
        <tbody>
        </tbody>
    </table>

    <script>
        function loadGPA() {
            fetch('/api/gpa')
                .then(response => response.json())
                .then(data => {
                    const tbody = document.querySelector('#gpaTable tbody');
                    tbody.innerHTML = '';
                    data.data.forEach(record => {
                        tbody.innerHTML += `
                            <tr>
                                <td>${record.student_id}</td>
                                <td>${record.name}</td>
                                <td>${record.grade}</td>
                                <td>${record.gpa}</td>
                                <td>
                                    <button onclick="deleteRecord('${record.student_id}')">Delete</button>
                                </td>
                            </tr>
                        `;
                    });
                });
        }

        function validateAndAdd() {
            const studentId = document.getElementById('studentId').value;
            const name = document.getElementById('studentName').value;
            const grade = document.getElementById('grade').value;
            const gpa = document.getElementById('gpa').value;

            if (!studentId || !name || !grade || !gpa) {
                alert('All fields are required!');
                return;
            }

            if (confirm('Are you sure you want to add this record?')) {
                addGPA(studentId, name, grade, gpa);
            }
        }

        function addGPA(studentId, name, grade, gpa) {
            const formData = new URLSearchParams();
            formData.append('student_id', studentId);
            formData.append('name', name);
            formData.append('grade', grade);
            formData.append('gpa', gpa);

            fetch('/add_gpa', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded',
                },
                body: formData
            })
            .then(response => response.json())
            .then(result => {
                alert(result.message);
                if (result.status === 'success') {
                    document.getElementById('studentId').value = '';
                    document.getElementById('studentName').value = '';
                    document.getElementById('grade').value = '';
                    document.getElementById('gpa').value = '';
                    loadGPA();
                }
            });
        }

        function deleteRecord(studentId) {
            if (confirm('Are you sure you want to delete this record?')) {
                fetch(`/delete_gpa/${studentId}`, {
                    method: 'DELETE'
                })
                .then(response => response.json())
                .then(result => {
                    alert(result.message);
                    if (result.status === 'success') {
                        loadGPA();
                    }
                });
            }
        }

        window.onload = loadGPA;
    </script>
</body>
</html>